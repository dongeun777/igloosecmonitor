<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="igloosec.monitor.mapper.MemberMapper">
    <select id="selectMember" resultType="MemberVo" parameterType="String">
        SELECT * FROM USER_LIST
        where email = #{username}
    </select>


    <select id="joinMember" parameterType="MemberVo">
        insert into USER_LIST (email, passwd,regDate,auth,rscGrp,ipAddr,company)
        values (#{email}, #{passwd},NOW(),#{auth},#{rscGrp},#{ipAddr},#{company});



    </select>


    <update id="createTmTable" parameterType="MemberVo">
        CREATE TABLE `is_stats_${rscGrp}` (
                                    `agent_id` VARCHAR(16) NOT NULL,
                                    `table_name` VARCHAR(255) NOT NULL,
                                    `category` VARCHAR(8) NULL DEFAULT NULL,
                                    `stats_period` VARCHAR(8) NOT NULL,
                                    `event_date` DATETIME NOT NULL,
                                    `event_count` BIGINT(20) NULL DEFAULT '0',
                                    `event_undefined` BIGINT(20) NULL DEFAULT '0',
                                    `event_volume` BIGINT(20) NULL DEFAULT '0',
                                    `event_compressed` BIGINT(20) NULL DEFAULT '0',
                                    `update_date` DATETIME NULL DEFAULT current_timestamp()
        )
            COLLATE='utf8mb4_general_ci'
            ENGINE=FEDERATED
            connection='mysql://admin:sp!dertm40@${ipAddr}:13306/esm/is_stats' COLLATE='utf8mb4_general_ci';

    </update>


    <select id="selectMemberList" resultType="MemberVo">
        SELECT email,auth,substring(regDate,1,10) AS regDate,rscGrp,ipAddr, CASE WHEN enabled =1 THEN 'ENABLED' ELSE 'DISABLED' END AS enableVal
        FROM USER_LIST

    </select>


    <update id="updatePw" parameterType="MemberVo">
        update USER_LIST SET passwd = #{passwd} where email = #{email};

    </update>

    <update id="modifyGrpIpMember" parameterType="MemberVo">
        update USER_LIST SET rscGrp= #{rscGrp}, ipAddr= #{ipAddr} where email = #{email};
    </update>



</mapper>


